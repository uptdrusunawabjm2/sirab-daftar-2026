<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Pendaftaran Rusunawa</title>
<script src="https://cdn.tailwindcss.com"></script>

<style>
.input{
width:100%;
background:#1e293b;
border:1px solid #334155;
border-radius:12px;
padding:10px;
}
#formWrapper{display:none;}
/* honeypot bot */
.hp{display:none;}
</style>
    <script src="https://www.google.com/recaptcha/api.js?render=YOUR_SITE_KEY"></script>
</head>

<body class="bg-gray-950 text-gray-100 min-h-screen">

<div class="max-w-3xl mx-auto p-6">

<!-- ================= INTRO ================= -->
<div id="introPage"
class="bg-gradient-to-b from-slate-900 to-slate-950 border border-slate-800
rounded-3xl shadow-2xl p-8 mb-6 max-w-2xl mx-auto">

<h1 class="text-2xl font-semibold text-center mb-4">
Permohonan Penghunian Rusunawa
</h1>

<p class="text-center text-slate-300 text-sm">
Dengan mengisi formulir ini anda menyatakan setuju seluruh ketentuan.
</p>

<hr class="my-6 border-slate-700">

<div class="mt-6 bg-blue-600/80 border border-blue-400/30 rounded-2xl p-5 space-y-3">

<label class="flex gap-3">
<input type="checkbox" id="agree1">
<span>Saya memahami tujuan pengumpulan data</span>
</label>

<label class="flex gap-3">
<input type="checkbox" id="agree2">
<span>Saya menyetujui seluruh ketentuan Peraturan Wali Kota Banjarmasin Nomor 149 Tahun 2023</span>
</label>

<a href="javascript:void(0)"
onclick="togglePasal()"
class="text-xs underline opacity-90 hover:opacity-100 block text-center">
Baca pernyataan lengkap
</a>
<!-- ===== PANEL PASAL 10 ===== -->
<div id="pasalBox"
class="hidden mt-3 bg-slate-900/60 border border-slate-700 rounded-xl p-4 text-sm text-slate-200">

<h3 class="text-center font-semibold mb-3">Pasal 10</h3>

<div class="space-y-1 text-left max-w-md mx-auto">
<p>a. Penghasilan maksimal 2x UMP.</p>
<p>b. Memiliki identitas kependudukan.</p>
<p>c. Sudah berkeluarga/menikah.</p>
<p>d. Anggota keluarga maksimal 4 orang.</p>
<p>e. Belum memiliki rumah/tempat tinggal sendiri.</p>
<p>f. Sanggup membayar sewa dan biaya lainnya.</p>

</div>
</div>
class="hidden mt-3 bg-slate-900/60 border border-slate-700 rounded-xl p-4 text-sm text-slate-200">

<h3 class="text-center font-semibold mb-3">Pasal 10</h3>

<div class="space-y-1 text-left max-w-md mx-auto">
<p>a. Penghasilan maksimal 2x UMP.</p>
<p>b. Memiliki identitas kependudukan.</p>
<p>c. Sudah berkeluarga/menikah.</p>
<p>d. Anggota keluarga maksimal 4 orang.</p>
<p>e. Belum memiliki rumah/tempat tinggal sendiri.</p>
<p>f. Sanggup membayar sewa dan biaya lainnya.</p>

</div>
</div>

<button id="btnIntroNext" disabled
class="w-full bg-blue-500 py-3 rounded-xl font-semibold">
Selanjutnya
</button>

</div>
</div>

<!-- ================= FORM ================= -->
<div id="formWrapper">

<h1 class="text-3xl font-bold mb-6 text-center">
Pendaftaran Calon Penghuni Rusunawa
</h1>

<div class="bg-slate-900 border border-slate-800 rounded-2xl shadow-xl p-6">

<div id="pages">

<!-- PAGE 1 -->
<div class="page space-y-4">
<label>Tanggal Formulir</label>
<input id="Tanggal Formulir" type="date" class="input">

<!-- honeypot bot -->
<input class="hp" id="website">
</div>

<!-- PAGE 2 -->
<div class="page hidden space-y-3">
<input id="Nama Pemohon" placeholder="Nama Pemohon" class="input">
<input id="NIK Pemohon" placeholder="NIK Pemohon" class="input">
<select id="Status Kependudukan" class="input">
<option value="">Status Kependudukan</option>
<option>Kota Banjarmasin</option>
<option>Penduduk Non Permanen</option>
</select>
<input id="Umur" placeholder="Umur" class="input">
<textarea id="Alamat sekarang" placeholder="Alamat sekarang" class="input"></textarea>
<input id="Nomor Telepon/HP/WA" placeholder="Nomor Telepon" class="input">
<input id="Email" placeholder="Email" class="input">
</div>

<!-- PAGE 3 -->
<div class="page hidden space-y-3">
<input id="Pekerjaan Pemohon" placeholder="Pekerjaan Pemohon" class="input">
<input id="Penghasilan perbulan" placeholder="Penghasilan" class="input">
<input id="Nama Penjamin" placeholder="Nama Penjamin" class="input">
<input id="NIK Penjamin" placeholder="NIK Penjamin" class="input">
</div>

</div>

<div class="flex justify-between mt-6">
<button onclick="prevPage()" id="prev"
class="bg-slate-700 px-5 py-2 rounded-xl">Kembali</button>

<button onclick="nextPage()" id="next"
class="bg-blue-600 px-5 py-2 rounded-xl font-bold">Lanjut</button>
</div>

<div id="msg" class="text-center mt-4 text-sm"></div>

</div>
</div>
</div>

<script>
const URL="PASTE_URL_WEBAPP_KAMU";

let page=0;
let lastSubmit=0;
const pages=document.querySelectorAll(".page");
const msg=document.getElementById("msg");

/* ===== TOGGLE PASAL ===== */
function togglePasal(){
  const box = document.getElementById("pasalBox");
  if(!box) return;
  box.classList.toggle("hidden");
}

/* ================= INTRO ================= */
const agree1=document.getElementById("agree1");
const agree2=document.getElementById("agree2");
const btnIntroNext=document.getElementById("btnIntroNext");

function checkAgree(){
btnIntroNext.disabled=!(agree1.checked&&agree2.checked);
}
agree1.onchange=checkAgree;
agree2.onchange=checkAgree;

btnIntroNext.onclick=()=>{
document.getElementById("introPage").style.display="none";
document.getElementById("formWrapper").style.display="block";
};

/* ================= TANGGAL + JAM + HARI ================= */
const tglInput=document.getElementById("Tanggal Formulir");
const now=new Date();
const yyyy=now.getFullYear();
const mm=String(now.getMonth()+1).padStart(2,"0");
const dd=String(now.getDate()).padStart(2,"0");
tglInput.value=`${yyyy}-${mm}-${dd}`;
tglInput.readOnly=true;

/* blok sabtu minggu */
const day=now.getDay();
if(day===0||day===6){
lockForm("Pelayanan tidak beroperasi pada hari libur nasional dan hari besar keagamaan");
}

/* lock jam WIB 08:00-16:00 */
const jam=now.getHours();
if(jam<8||jam>=16){
lockForm("Pendaftaran hanya buka 08:00 - 16:00 WITA");
}

function lockForm(text){
msg.className="text-red-400";
msg.innerText=text;
document.getElementById("next").disabled=true;
}

/* ================= PAGINATION ================= */
function showPage(){
pages.forEach((p,i)=>p.classList.toggle("hidden",i!==page));
prev.style.visibility=page===0?"hidden":"visible";
next.innerText=page===pages.length-1?"KIRIM":"Lanjut";
}
showPage();

function validatePage(){
const inputs=pages[page].querySelectorAll("input,textarea,select");
for(const x of inputs){
if(x.classList.contains("hp")) continue;
if(!x.value){
msg.innerText="Semua field wajib diisi";
msg.className="text-red-400";
return false;
}
}

/* VALIDASI NIK 16 DIGIT */
const nik=document.getElementById("NIK Pemohon");
if(nik&&page===1){
if(!/^\d{16}$/.test(nik.value)){
msg.innerText="NIK harus 16 digit angka";
msg.className="text-red-400";
return false;
}
}

msg.innerText="";
return true;
}

function nextPage(){
if(!validatePage())return;
if(page<pages.length-1){page++;showPage();}
else kirim();
}

function prevPage(){
if(page>0){page--;showPage();}
}

/* ================= SUBMIT ================= */
async function kirim(){

/* anti spam cooldown 10 detik */
if(Date.now()-lastSubmit<10000){
msg.className="text-red-400";
msg.innerText="Tunggu beberapa detik sebelum kirim lagi";
return;
}

/* honeypot bot */
if(document.getElementById("website").value){
return;
}

if(!validatePage())return;

lastSubmit=Date.now();
next.disabled=true;
msg.innerText="Mengirim...";

const data={};
document.querySelectorAll("input,textarea,select").forEach(x=>{
if(x.id&&!x.classList.contains("hp"))data[x.id]=x.value;
});

try{
const r=await fetch(URL+"?action=daftar",{
method:"POST",
body:JSON.stringify(data)
});
const j=await r.json();

if(j.status){
msg.className="text-green-400";
msg.innerText="Pendaftaran berhasil. No: "+j.no;
document.querySelectorAll("input,textarea,select").forEach(x=>x.value="");
page=0;showPage();
}else{
msg.className="text-red-400";
msg.innerText=j.message||"Gagal";
}
}catch{
msg.className="text-red-400";
msg.innerText="Server tidak merespon";
}

next.disabled=false;
}
</script>

</body>
</html>
