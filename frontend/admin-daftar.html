<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Admin Pendaftaran</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<script src="https://cdn.tailwindcss.com"></script>
<script src="config.js"></script>
</head>

<body class="bg-slate-950 text-white min-h-screen flex">

<div class="flex-1 flex flex-col">

<div class="bg-slate-900 border-b border-slate-800 p-3 text-center font-semibold">
Dashboard Admin Pendaftaran (Realtime)
</div>

<div class="p-4 space-y-3">

<!-- PAGINATION CONTROL -->
<div class="flex flex-wrap gap-2 items-center">
<select id="rowsPerPage" class="bg-slate-800 border border-slate-700 p-1 rounded">
<option value="10">10</option>
<option value="25">25</option>
<option value="50">50</option>
<option value="100">100</option>
</select>

<button onclick="prevPage()" class="bg-slate-700 px-3 py-1 rounded">Prev</button>
<span id="pageInfo"></span>
<button onclick="nextPage()" class="bg-slate-700 px-3 py-1 rounded">Next</button>

<span class="ml-auto text-xs text-slate-400">
Realtime aktif (refresh tiap 5 detik)
</span>
</div>

<div class="bg-slate-900 border border-slate-800 rounded-xl overflow-auto max-h-[75vh]">
<table class="w-full text-sm" id="table"></table>
</div>

</div>
</div>

<script>
const API = CONFIG.API;
const KEY = CONFIG.INTERNAL_KEY;

let HEAD=[], DATA=[];
let page=1;
let rows=25;
let lastHash="";

/* ===== LOAD DATA ===== */
async function load(){

  const r = await fetch(API+"?action=daftar_all&key="+KEY);
  const j = await r.json();

  const newHash = j.data.length + "_" + (j.data[0]?.join("|") || "");

  if(newHash !== lastHash){
    HEAD=j.header;
const oldLen = DATA.length;
DATA=j.data;

if(DATA.length !== oldLen){
  page = 1;
}

lastHash = newHash;
render();
}
}

/* ===== RENDER ===== */
function render(){

  rows=parseInt(rowsPerPage.value);
  const start=(page-1)*rows;
  const end=start+rows;
  const slice=DATA.slice(start,end);

  let h="<tr class='bg-slate-800 sticky top-0'>";
  HEAD.forEach(c=>h+=`<th class="p-2 border border-slate-700">${c}</th>`);
  h+="</tr>";

  slice.forEach(r=>{
    h+="<tr class='hover:bg-slate-800'>";
    r.forEach(v=>{
      h+=`<td class="p-2 border border-slate-800">${v||""}</td>`;
    });
    h+="</tr>";
  });

  table.innerHTML=h;

  const totalPages=Math.ceil(DATA.length/rows)||1;
  pageInfo.textContent=`Page ${page} / ${totalPages}`;
}

/* ===== PAGINATION ===== */
function nextPage(){
  const totalPages=Math.ceil(DATA.length/rows)||1;
  if(page<totalPages){ page++; render(); }
}

function prevPage(){
  if(page>1){ page--; render(); }
}

rowsPerPage.onchange=()=>{ page=1; render(); };

/* ===== REALTIME LOOP ===== */
load();
setInterval(load,5000);
</script>

</body>
</html>
